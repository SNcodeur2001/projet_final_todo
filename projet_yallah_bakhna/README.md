# üöÄ Projet Yallah Bakhna - API de Gestion des T√¢ches

Une API REST moderne pour la gestion des t√¢ches avec syst√®me de permissions et pi√®ces jointes, d√©velopp√©e avec Node.js, Express, TypeScript et Prisma.

## üìã Table des Mati√®res

- [Fonctionnalit√©s](#fonctionnalit√©s)
- [Technologies Utilis√©es](#technologies-utilis√©es)
- [Pr√©requis](#pr√©requis)
- [Installation](#installation)
- [Configuration](#configuration)
- [Utilisation](#utilisation)
- [API Endpoints](#api-endpoints)
- [Authentification](#authentification)
- [Syst√®me de Permissions](#syst√®me-de-permissions)
- [Gestion des Pi√®ces Jointes](#gestion-des-pi√®ces-jointes)
- [Structure du Projet](#structure-du-projet)
- [Base de Donn√©es](#base-de-donn√©es)
- [Conventions de Code](#conventions-de-code)
- [D√©veloppement](#d√©veloppement)
- [Tests](#tests)
- [D√©ploiement](#d√©ploiement)
- [Contribuer](#contribuer)
- [Licence](#licence)

## ‚ú® Fonctionnalit√©s

- ‚úÖ **CRUD complet** pour les t√¢ches
- ‚úÖ **Syst√®me d'authentification** JWT
- ‚úÖ **Gestion des utilisateurs** avec r√¥les (ADMIN/USER)
- ‚úÖ **Syst√®me de permissions** granulaire pour les t√¢ches
- ‚úÖ **Upload d'images** et gestion des pi√®ces jointes
- ‚úÖ **Validation des donn√©es** avec Zod
- ‚úÖ **Gestion des statuts** (EN_ATTENTE, EN_COURS, TERMINE)
- ‚úÖ **Architecture MVC** propre et maintenable
- ‚úÖ **TypeScript** pour la s√©curit√© des types
- ‚úÖ **Base de donn√©es MySQL** avec Prisma ORM
- ‚úÖ **Gestion d'erreurs** robuste
- ‚úÖ **Documentation API** compl√®te

## üõ† Technologies Utilis√©es

- **Backend**: Node.js, Express.js
- **Langage**: TypeScript
- **Base de donn√©es**: MySQL avec Prisma ORM
- **Authentification**: JWT (jsonwebtoken)
- **Validation**: Zod
- **Upload de fichiers**: Multer
- **S√©curit√©**: bcrypt pour le hachage des mots de passe
- **D√©veloppement**: ts-node-dev, nodemon

## üìã Pr√©requis

- Node.js (version 16 ou sup√©rieure)
- MySQL (version 8.0 ou sup√©rieure)
- npm ou yarn

## üöÄ Installation

1. **Cloner le repository**
   ```bash
   git clone https://github.com/votre-username/projet_yallah_bakhna.git
   cd projet_yallah_bakhna
   ```

2. **Installer les d√©pendances**
   ```bash
   npm install
   ```

3. **Configuration de la base de donn√©es**
   ```bash
   # Cr√©er un fichier .env √† la racine du projet
   cp .env.example .env

   # Modifier le fichier .env avec vos informations
   DATABASE_URL="mysql://username:password@localhost:3306/yallah_bakhna_db"
   JWT_SECRET="votre_secret_jwt_tres_securise"
   ```

4. **Initialiser la base de donn√©es**
   ```bash
   # Appliquer les migrations Prisma
   npm run db:migrate

   # G√©n√©rer le client Prisma
   npx prisma generate
   ```

## ‚öôÔ∏è Configuration

### Variables d'environnement (.env)

```env
# Base de donn√©es
DATABASE_URL="mysql://username:password@localhost:3306/yallah_bakhna_db"

# JWT
JWT_SECRET="votre_secret_jwt_tres_securise"

# Port du serveur (optionnel, d√©faut: 3000)
PORT=3000

# Environnement (development/production)
NODE_ENV=development
```

## üéØ Utilisation

### D√©marrage en mode d√©veloppement
```bash
npm run dev
```

Le serveur d√©marrera sur `http://localhost:3000`

### Construction pour la production
```bash
npm run build
npm start
```

## üìö API Endpoints

### Base URL
```
http://localhost:3000/api
```

## üîê Authentification

### Inscription d'un utilisateur
```http
POST /api/auth/register
Content-Type: application/json

{
  "nom": "Ndiaye",
  "prenom": "Mapathe",
  "login": "mapathe.ndiaye",
  "password": "motdepasse123"
}
```

**R√©ponse de succ√®s (201):**
```json
{
  "status": "success",
  "data": {
    "user": {
      "id": 1,
      "nom": "Ndiaye",
      "prenom": "Mapathe",
      "login": "mapathe.ndiaye",
      "role": "USER"
    },
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
  }
}
```

### Connexion d'un utilisateur
```http
POST /api/auth/login
Content-Type: application/json

{
  "login": "mapathe.ndiaye",
  "password": "motdepasse123"
}
```

**R√©ponse de succ√®s (200):**
```json
{
  "status": "success",
  "data": {
    "user": {
      "id": 1,
      "nom": "Ndiaye",
      "prenom": "Mapathe",
      "login": "mapathe.ndiaye",
      "role": "USER"
    },
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
  }
}
```

## üìù Gestion des T√¢ches

> **Note**: Tous les endpoints de t√¢ches n√©cessitent une authentification JWT via le header `Authorization: Bearer <token>`

### Cr√©er une t√¢che
```http
POST /api/taches
Authorization: Bearer <token>
Content-Type: application/json

{
  "libelle": "D√©velopper l'API",
  "description": "Cr√©er une API REST pour la gestion des t√¢ches",
  "status": "EN_ATTENTE"
}
```

**R√©ponse de succ√®s (201):**
```json
{
  "status": "success",
  "data": {
    "id": 1,
    "libelle": "D√©velopper l'API",
    "description": "Cr√©er une API REST pour la gestion des t√¢ches",
    "status": "EN_ATTENTE",
    "userId": 1
  }
}
```

### R√©cup√©rer toutes les t√¢ches
```http
GET /api/taches
Authorization: Bearer <token>
```

**R√©ponse de succ√®s (200):**
```json
{
  "status": "success",
  "data": [
    {
      "id": 1,
      "libelle": "D√©velopper l'API",
      "description": "Cr√©er une API REST pour la gestion des t√¢ches",
      "status": "EN_ATTENTE",
      "userId": 1
    }
  ]
}
```

### R√©cup√©rer une t√¢che par ID
```http
GET /api/taches/1
Authorization: Bearer <token>
```

**R√©ponse de succ√®s (200):**
```json
{
  "status": "success",
  "data": {
    "id": 1,
    "libelle": "D√©velopper l'API",
    "description": "Cr√©er une API REST pour la gestion des t√¢ches",
    "status": "EN_ATTENTE",
    "userId": 1
  }
}
```

### Mettre √† jour une t√¢che
```http
PUT /api/taches/1
Authorization: Bearer <token>
Content-Type: application/json

{
  "libelle": "API REST compl√©t√©e",
  "status": "EN_COURS"
}
```

**R√©ponse de succ√®s (200):**
```json
{
  "status": "success",
  "data": {
    "id": 1,
    "libelle": "API REST compl√©t√©e",
    "description": "Cr√©er une API REST pour la gestion des t√¢ches",
    "status": "EN_COURS",
    "userId": 1
  }
}
```

### Supprimer une t√¢che
```http
DELETE /api/taches/1
Authorization: Bearer <token>
```

**R√©ponse de succ√®s (200):**
```json
{
  "status": "success",
  "data": {
    "id": 1,
    "libelle": "API REST compl√©t√©e",
    "description": "Cr√©er une API REST pour la gestion des t√¢ches",
    "status": "EN_COURS",
    "userId": 1
  }
}
```

### Marquer une t√¢che comme termin√©e
```http
PATCH /api/taches/1/termine
Authorization: Bearer <token>
```

**R√©ponse de succ√®s (200):**
```json
{
  "status": "success",
  "data": {
    "id": 1,
    "libelle": "API REST compl√©t√©e",
    "description": "Cr√©er une API REST pour la gestion des t√¢ches",
    "status": "TERMINE",
    "userId": 1
  }
}
```

## üîë Syst√®me de Permissions

### Types de permissions disponibles
- **READ_ONLY**: Lecture seule de la t√¢che
- **MODIFY_ONLY**: Modification de la t√¢che (pas de suppression)
- **FULL_ACCESS**: Acc√®s complet (modification + suppression + pi√®ces jointes)

### Attribuer une permission √† un utilisateur
```http
POST /api/taches/1/permissions
Authorization: Bearer <token>
Content-Type: application/json

{
  "userId": 2,
  "permission": "MODIFY_ONLY"
}
```

**R√©ponse de succ√®s (200):**
```json
{
  "status": "success",
  "data": {
    "id": 1,
    "tacheId": 1,
    "userId": 2,
    "permission": "MODIFY_ONLY"
  }
}
```

### Voir les permissions d'une t√¢che
```http
GET /api/taches/1/permissions
Authorization: Bearer <token>
```

**R√©ponse de succ√®s (200):**
```json
{
  "status": "success",
  "data": [
    {
      "id": 1,
      "tacheId": 1,
      "userId": 2,
      "permission": "MODIFY_ONLY",
      "user": {
        "id": 2,
        "nom": "Diop",
        "prenom": "Fatou",
        "login": "fatou.diop"
      }
    }
  ]
}
```

### Retirer une permission
```http
DELETE /api/taches/1/permissions/2
Authorization: Bearer <token>
```

**R√©ponse de succ√®s (200):**
```json
{
  "status": "success",
  "data": {
    "id": 1,
    "tacheId": 1,
    "userId": 2,
    "permission": "MODIFY_ONLY"
  }
}
```

## üìé Gestion des Pi√®ces Jointes

### Ajouter une pi√®ce jointe (image)
```http
POST /api/taches/1/attachments
Authorization: Bearer <token>
Content-Type: multipart/form-data

file: <image_file>
```

**Exemple avec curl:**
```bash
curl -X POST http://localhost:3000/api/taches/1/attachments \
  -H "Authorization: Bearer <token>" \
  -F "file=@image.jpg"
```

**R√©ponse de succ√®s (201):**
```json
{
  "status": "success",
  "data": {
    "id": 1,
    "tacheId": 1,
    "filename": "file-1641234567890-123456789.jpg",
    "originalName": "image.jpg",
    "mimetype": "image/jpeg",
    "size": 245760,
    "url": "/uploads/images/file-1641234567890-123456789.jpg",
    "createdAt": "2024-01-03T10:30:00.000Z"
  }
}
```

### Voir les pi√®ces jointes d'une t√¢che
```http
GET /api/taches/1/attachments
Authorization: Bearer <token>
```

**R√©ponse de succ√®s (200):**
```json
{
  "status": "success",
  "data": [
    {
      "id": 1,
      "tacheId": 1,
      "filename": "file-1641234567890-123456789.jpg",
      "originalName": "image.jpg",
      "mimetype": "image/jpeg",
      "size": 245760,
      "url": "/uploads/images/file-1641234567890-123456789.jpg",
      "createdAt": "2024-01-03T10:30:00.000Z"
    }
  ]
}
```

### Supprimer une pi√®ce jointe
```http
DELETE /api/taches/attachments/1
Authorization: Bearer <token>
```

**R√©ponse de succ√®s (200):**
```json
{
  "status": "success",
  "data": {
    "id": 1,
    "tacheId": 1,
    "filename": "file-1641234567890-123456789.jpg",
    "originalName": "image.jpg",
    "mimetype": "image/jpeg",
    "size": 245760,
    "url": "/uploads/images/file-1641234567890-123456789.jpg",
    "createdAt": "2024-01-03T10:30:00.000Z"
  }
}
```

### Acc√©der √† une image upload√©e
```http
GET /uploads/images/file-1641234567890-123456789.jpg
```

Cette URL retourne directement le fichier image.

## üìä R√©capitulatif des Endpoints

| M√©thode | Endpoint | Description | Auth Required |
|---------|----------|-------------|---------------|
| **Authentification** |
| `POST` | `/api/auth/register` | Inscription d'un utilisateur | ‚ùå |
| `POST` | `/api/auth/login` | Connexion d'un utilisateur | ‚ùå |
| **Gestion des T√¢ches** |
| `GET` | `/api/taches` | R√©cup√©rer toutes les t√¢ches | ‚úÖ |
| `GET` | `/api/taches/:id` | R√©cup√©rer une t√¢che par ID | ‚úÖ |
| `POST` | `/api/taches` | Cr√©er une nouvelle t√¢che | ‚úÖ |
| `PUT` | `/api/taches/:id` | Mettre √† jour une t√¢che | ‚úÖ |
| `DELETE` | `/api/taches/:id` | Supprimer une t√¢che | ‚úÖ |
| `PATCH` | `/api/taches/:id/termine` | Marquer une t√¢che comme termin√©e | ‚úÖ |
| **Permissions** |
| `POST` | `/api/taches/:id/permissions` | Attribuer une permission | ‚úÖ |
| `GET` | `/api/taches/:id/permissions` | Voir les permissions d'une t√¢che | ‚úÖ |
| `DELETE` | `/api/taches/:id/permissions/:userId` | Retirer une permission | ‚úÖ |
| **Pi√®ces Jointes** |
| `POST` | `/api/taches/:id/attachments` | Ajouter une pi√®ce jointe | ‚úÖ |
| `GET` | `/api/taches/:id/attachments` | Voir les pi√®ces jointes | ‚úÖ |
| `DELETE` | `/api/taches/attachments/:attachmentId` | Supprimer une pi√®ce jointe | ‚úÖ |
| `GET` | `/uploads/images/:filename` | Acc√©der √† une image | ‚ùå |

## ‚ö†Ô∏è Codes de Statut HTTP

- `200` - Succ√®s
- `201` - Cr√©√© avec succ√®s
- `400` - Erreur de validation ou donn√©es invalides
- `401` - Non authentifi√© (token manquant ou invalide)
- `403` - Acc√®s interdit (permissions insuffisantes)
- `404` - Ressource non trouv√©e
- `500` - Erreur serveur interne

## üîí R√®gles de S√©curit√© et Permissions

### Authentification
- Tous les endpoints (sauf `/auth/register` et `/auth/login`) n√©cessitent un token JWT
- Le token doit √™tre inclus dans le header: `Authorization: Bearer <token>`

### Permissions sur les T√¢ches
- **Cr√©ateur de la t√¢che**: Peut faire toutes les op√©rations
- **READ_ONLY**: Peut seulement voir la t√¢che et ses pi√®ces jointes
- **MODIFY_ONLY**: Peut modifier la t√¢che et ajouter des pi√®ces jointes
- **FULL_ACCESS**: Peut tout faire sauf g√©rer les permissions

### Upload de Fichiers
- Taille limite: 5MB par fichier
- Types autoris√©s: Images uniquement (image/*)
- Stockage: Dossier `uploads/images/`

## üèó Structure du Projet

```
projet_yallah_bakhna/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ controllers/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.controller.ts          # Authentification
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ tache.controller.ts         # Gestion des t√¢ches
‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ user.service.ts             # Logique utilisateurs
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ tache.service.ts            # Logique t√¢ches
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ permission.service.ts       # Logique permissions
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ attachment.service.ts       # Logique pi√®ces jointes
‚îÇ   ‚îú‚îÄ‚îÄ repositories/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ user.repositorie.ts         # Acc√®s donn√©es utilisateurs
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ tache.repositorie.ts        # Acc√®s donn√©es t√¢ches
‚îÇ   ‚îú‚îÄ‚îÄ routes/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.route.ts               # Routes authentification
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ tache.route.ts              # Routes t√¢ches
‚îÇ   ‚îú‚îÄ‚îÄ validators/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.validator.ts           # Validation auth
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ tache.validator.ts          # Validation t√¢ches
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ permission.validator.ts     # Validation permissions
‚îÇ   ‚îú‚îÄ‚îÄ middlewares/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ auth.middleware.ts          # Middleware JWT
‚îÇ   ‚îú‚îÄ‚îÄ utils/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ upload.ts                   # Configuration upload
‚îÇ   ‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ rbac.ts                     # Configuration RBAC
‚îÇ   ‚îî‚îÄ‚îÄ index.ts                        # Point d'entr√©e
‚îú‚îÄ‚îÄ prisma/
‚îÇ   ‚îú‚îÄ‚îÄ schema.prisma                   # Sch√©ma de base de donn√©es
‚îÇ   ‚îî‚îÄ‚îÄ migrations/                     # Migrations
‚îú‚îÄ‚îÄ uploads/
‚îÇ   ‚îî‚îÄ‚îÄ images/                         # Images upload√©es
‚îú‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ tsconfig.json
‚îú‚îÄ‚îÄ .env                                # Variables d'environnement
‚îî‚îÄ‚îÄ README.md
```

## üóÑÔ∏è Base de Donn√©es

### Sch√©ma Prisma Complet

```prisma
enum Role {
  ADMIN
  USER
}

enum StatusTache {
  EN_ATTENTE
  EN_COURS
  TERMINE
}

enum PermissionType {
  READ_ONLY
  MODIFY_ONLY
  FULL_ACCESS
}

model User {
  id                Int                @id @default(autoincrement())
  nom               String
  prenom            String
  login             String             @unique
  password          String
  role              Role               @default(USER)
  taches            Tache[]
  tachePermissions  TachePermission[]
}

model Tache {
  id           Int                @id @default(autoincrement())
  libelle      String
  description  String?
  status       StatusTache        @default(EN_ATTENTE)
  userId       Int
  user         User               @relation(fields: [userId], references: [id], onDelete: Cascade)
  permissions  TachePermission[]
  attachments  TacheAttachment[]
}

model TachePermission {
  id         Int            @id @default(autoincrement())
  tacheId    Int
  userId     Int
  permission PermissionType
  tache      Tache          @relation(fields: [tacheId], references: [id], onDelete: Cascade)
  user       User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@unique([tacheId, userId])
}

model TacheAttachment {
  id           Int      @id @default(autoincrement())
  tacheId      Int
  filename     String
  originalName String
  mimetype     String
  size         Int
  url          String
  tache        Tache    @relation(fields: [tacheId], references: [id], onDelete: Cascade)
  createdAt    DateTime @default(now())
}
```

## üìù Conventions de Code

### Pr√©fixe des Variables et Constantes

Toutes les variables et constantes doivent √™tre pr√©fix√©es par `mn` :

```typescript
// ‚úÖ Correct
const mnTacheService = new TacheService();
const mnRouter = Router();
const mnPort = 3000;

// ‚ùå Incorrect
const tacheService = new TacheService();
const router = Router();
const port = 3000;
```

## üíª D√©veloppement

### Scripts Disponibles

```bash
# D√©veloppement avec rechargement automatique
npm run dev

# Construction pour la production
npm run build

# D√©marrage en production
npm start

# Migration de base de donn√©es
npm run db:migrate
```

## üß™ Tests

*(√Ä impl√©menter)*

```bash
# Ex√©cuter les tests
npm test

# Tests avec couverture
npm run test:coverage
```

## üöÄ D√©ploiement

### Pr√©paration pour la production

1. **Construction de l'application**
   ```bash
   npm run build
   ```

2. **Configuration des variables d'environnement**
   ```env
   NODE_ENV=production
   DATABASE_URL="mysql://prod-user:prod-password@prod-host:3306/prod-db"
   JWT_SECRET="votre_secret_jwt_production_tres_securise"
   ```

3. **D√©marrage du serveur**
   ```bash
   npm start
   ```

## ü§ù Contribuer

1. Fork le projet
2. Cr√©er une branche pour votre fonctionnalit√© (`git checkout -b feature/AmazingFeature`)
3. Commit vos changements (`git commit -m 'Add some AmazingFeature'`)
4. Push vers la branche (`git push origin feature/AmazingFeature`)
5. Ouvrir une Pull Request

## üìÑ Licence

Ce projet est sous licence MIT - voir le fichier [LICENSE](LICENSE) pour plus de d√©tails.

## üìû Support

Pour toute question ou probl√®me, veuillez ouvrir une issue sur GitHub ou contacter l'√©quipe de d√©veloppement.

---

**D√©velopp√© avec ‚ù§Ô∏è par [Mapathe Ndiaye]**# projet_todo_express
# backend_yallah_bakhna
# backend_yallah_bakhna
